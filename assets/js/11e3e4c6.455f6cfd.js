"use strict";(self.webpackChunkvulkan_doc=self.webpackChunkvulkan_doc||[]).push([[3225],{27:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>c,contentTitle:()=>a,default:()=>m,frontMatter:()=>s,metadata:()=>l,toc:()=>d});var i=n(4848),t=n(8453);const s={title:"vkCmdBlitImage",description:"vkCmdBlitImage"},a=":material-chevron-right-circle: vkCmdBlitImage",l={id:"api/vkCmdBlitImage",title:"vkCmdBlitImage",description:"vkCmdBlitImage",source:"@site/docs/api/vkCmdBlitImage.md",sourceDirName:"api",slug:"/api/vkCmdBlitImage",permalink:"/api/vkCmdBlitImage",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"vkCmdBlitImage",description:"vkCmdBlitImage"},sidebar:"VulkanApi",previous:{title:"vkCmdBindVertexBuffers",permalink:"/api/vkCmdBindVertexBuffers"},next:{title:"vkCmdClearAttachments",permalink:"/api/vkCmdClearAttachments"}},c={},d=[{value:"\u51fd\u6570\u539f\u578b",id:"\u51fd\u6570\u539f\u578b",level:2},{value:"\u63cf\u8ff0",id:"\u63cf\u8ff0",level:2},{value:"\u8865\u5145",id:"\u8865\u5145",level:2},{value:"\u53c2\u6570",id:"\u53c2\u6570",level:2},{value:"\u8fd4\u56de\u503c",id:"\u8fd4\u56de\u503c",level:2},{value:"\u4ee3\u7801\u793a\u4f8b",id:"\u4ee3\u7801\u793a\u4f8b",level:2}];function o(e){const r={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.header,{children:(0,i.jsx)(r.h1,{id:"material-chevron-right-circle-vkcmdblitimage",children:":material-chevron-right-circle: vkCmdBlitImage"})}),"\n",(0,i.jsx)(r.h2,{id:"\u51fd\u6570\u539f\u578b",children:"\u51fd\u6570\u539f\u578b"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-c",children:"void vkCmdBlitImage(\r\n    VkCommandBuffer        commandBuffer,\r\n    VkImage                srcImage,\r\n    VkImageLayout          srcImageLayout,\r\n    VkImage                dstImage,\r\n    VkImageLayout          dstImageLayout,\r\n    uint32_t               regionCount,\r\n    const VkImageBlit*     pRegions,\r\n    VkFilter               filter);\n"})}),"\n",(0,i.jsx)(r.h2,{id:"\u63cf\u8ff0",children:"\u63cf\u8ff0"}),"\n",(0,i.jsx)(r.p,{children:"\u7528\u4e8e\u56fe\u50cf\u7f29\u653e\u3001\u56fe\u50cf\u683c\u5f0f\u8f6c\u6362\u3001\u751f\u6210 mipmap\u7b49\u56fe\u50cf\u590d\u5236\u529f\u80fd\u3002"}),"\n",(0,i.jsx)(r.h2,{id:"\u8865\u5145",children:"\u8865\u5145"}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.code,{children:"VkImageBlit"})," \u7ed3\u6784\u4f53\u5b9a\u4e49\uff1a"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"typedef struct VkImageBlit {\r\n    VkImageSubresourceLayers srcSubresource;\r\n    VkOffset3D               srcOffsets[2];\r\n    VkImageSubresourceLayers dstSubresource;\r\n    VkOffset3D               dstOffsets[2];\r\n} VkImageBlit;\n"})}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.code,{children:"VkImageSubresourceLayers"})," \u7ed3\u6784\u4f53\u5b9a\u4e49\uff1a"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"VkImageSubresourceLayers {\r\n    VkImageAspectFlags aspectMask;  // \u901a\u5e38\u4e3a VK_IMAGE_ASPECT_COLOR_BIT\r\n    uint32_t mipLevel;              // mip \u7b49\u7ea7\r\n    uint32_t baseArrayLayer;        // \u6570\u7ec4\u5c42\u8d77\u59cb\u7d22\u5f15\uff08\u5982\u7acb\u65b9\u4f53\u56fe\u4e3a 0-5\uff09\r\n    uint32_t layerCount;            // \u5c42\u6570\uff08\u901a\u5e38\u4e3a 1\uff09\r\n}\n"})}),"\n",(0,i.jsx)(r.p,{children:"srcOffsets[2] / dstOffsets[2]\uff1a\r\n\u6307\u5b9a blit \u533a\u57df\u7684\u8d77\u70b9\u548c\u7ec8\u70b9\uff1a"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"offsets[0]: \u5de6\u4e0a\u524d\uff08x, y, z\uff09"}),"\n",(0,i.jsx)(r.li,{children:"offsets[1]: \u53f3\u4e0b\u540e\uff08x, y, z\uff09"}),"\n",(0,i.jsx)(r.li,{children:"\u6ce8\u610f\uff1a\u5750\u6807\u4e0d\u5305\u542b\u53f3\u4e0b\u89d2\uff0c\u884c\u4e3a\u7c7b\u4f3c Python \u5207\u7247"}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"\u53c2\u6570",children:"\u53c2\u6570"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"commandBuffer"})," : \u5f55\u5236\u6307\u4ee4\u7684\u547d\u4ee4\u7f13\u51b2\u533a\u3002"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"srcImage"})," : \u6e90\u56fe\u50cf\u3002"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"srcImageLayout"})," : \u6e90\u56fe\u50cf\u5f53\u524d layout\u3002"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"dstImage"})," : \u76ee\u6807\u56fe\u50cf\u3002"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"dstImageLayout"})," : \u76ee\u6807\u56fe\u50cf\u5f53\u524d layout\u3002"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"regionCount"})," : blit \u533a\u57df\u7684\u6570\u91cf\u3002"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"pRegions"})," : \u8981\u6267\u884c blit \u7684\u533a\u57df\u3002"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"filter"})," : ",(0,i.jsx)(r.code,{children:"VK_FILTER_LINEAR"}),"\uff08\u7f29\u653e\u65f6\u7ebf\u6027\u63d2\u503c\uff09\u6216 ",(0,i.jsx)(r.code,{children:"VK_FILTER_NEAREST"}),"\uff08\u6700\u90bb\u8fd1\uff09\u3002"]}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"\u8fd4\u56de\u503c",children:"\u8fd4\u56de\u503c"}),"\n",(0,i.jsx)(r.p,{children:"\u65e0"}),"\n",(0,i.jsx)(r.h2,{id:"\u4ee3\u7801\u793a\u4f8b",children:"\u4ee3\u7801\u793a\u4f8b"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-cpp",children:"//\u751f\u6210 mipmap\r\nvoid GenerateMipmaps(VkCommandBuffer cmd, VkImage image, int32_t width, int32_t height, uint32_t mipLevels) {\r\n    VkImageMemoryBarrier barrier{};\r\n    barrier.sType = VK_STRUCTURE_TYPE_IMAGE_MEMORY_BARRIER;\r\n    barrier.image = image;\r\n    barrier.srcQueueFamilyIndex = VK_QUEUE_FAMILY_IGNORED;\r\n    barrier.dstQueueFamilyIndex = VK_QUEUE_FAMILY_IGNORED;\r\n    barrier.subresourceRange.aspectMask = VK_IMAGE_ASPECT_COLOR_BIT;\r\n    barrier.subresourceRange.baseArrayLayer = 0;\r\n    barrier.subresourceRange.layerCount = 1;\r\n    barrier.subresourceRange.levelCount = 1;\r\n\r\n    for (uint32_t i = 1; i < mipLevels; i++) {\r\n        // Transition mip[i-1] to SRC\r\n        barrier.subresourceRange.baseMipLevel = i - 1;\r\n        barrier.oldLayout = VK_IMAGE_LAYOUT_TRANSFER_DST_OPTIMAL;\r\n        barrier.newLayout = VK_IMAGE_LAYOUT_TRANSFER_SRC_OPTIMAL;\r\n        barrier.srcAccessMask = VK_ACCESS_TRANSFER_WRITE_BIT;\r\n        barrier.dstAccessMask = VK_ACCESS_TRANSFER_READ_BIT;\r\n\r\n        vkCmdPipelineBarrier(cmd,\r\n            VK_PIPELINE_STAGE_TRANSFER_BIT, VK_PIPELINE_STAGE_TRANSFER_BIT, 0,\r\n            0, nullptr, 0, nullptr, 1, &barrier);\r\n\r\n        // Blit mip[i-1] to mip[i]\r\n        VkImageBlit blit{};\r\n        blit.srcSubresource.aspectMask = VK_IMAGE_ASPECT_COLOR_BIT;\r\n        blit.srcSubresource.mipLevel = i - 1;\r\n        blit.srcSubresource.baseArrayLayer = 0;\r\n        blit.srcSubresource.layerCount = 1;\r\n        blit.srcOffsets[0] = {0, 0, 0};\r\n        blit.srcOffsets[1] = {width, height, 1};\r\n\r\n        int32_t mipWidth  = width  > 1 ? width  / 2 : 1;\r\n        int32_t mipHeight = height > 1 ? height / 2 : 1;\r\n\r\n        blit.dstSubresource.aspectMask = VK_IMAGE_ASPECT_COLOR_BIT;\r\n        blit.dstSubresource.mipLevel = i;\r\n        blit.dstSubresource.baseArrayLayer = 0;\r\n        blit.dstSubresource.layerCount = 1;\r\n        blit.dstOffsets[0] = {0, 0, 0};\r\n        blit.dstOffsets[1] = {mipWidth, mipHeight, 1};\r\n\r\n        vkCmdBlitImage(cmd, image, VK_IMAGE_LAYOUT_TRANSFER_SRC_OPTIMAL,\r\n                            image, VK_IMAGE_LAYOUT_TRANSFER_DST_OPTIMAL,\r\n                            1, &blit, VK_FILTER_LINEAR);\r\n\r\n        width = mipWidth;\r\n        height = mipHeight;\r\n    }\r\n}\n"})})]})}function m(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>a,x:()=>l});var i=n(6540);const t={},s=i.createContext(t);function a(e){const r=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function l(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),i.createElement(s.Provider,{value:r},e.children)}}}]);