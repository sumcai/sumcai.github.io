"use strict";(self.webpackChunkvulkan_doc=self.webpackChunkvulkan_doc||[]).push([[9684],{5080:(n,r,e)=>{e.r(r),e.d(r,{assets:()=>o,contentTitle:()=>i,default:()=>g,frontMatter:()=>f,metadata:()=>a,toc:()=>c});var l=e(4848),t=e(8453);const f={title:"Stencil\u7528\u6cd5",categories:["opengl\u6280\u672f"],tags:["opengl\u57fa\u7840","stencil"],date:new Date("2021-12-15T22:13:01.000Z"),authors:"sumcai",permalink:"/opengl/stencil/"},i="\u6a21\u677f\u6d4b\u8bd5",a={permalink:"/blog/07.Stencil\u7528\u6cd5",source:"@site/blog/07.Stencil\u7528\u6cd5.md",title:"Stencil\u7528\u6cd5",description:"opengl\u7684stencil\u79f0\u4e3a\u6a21\u677f\u6d4b\u8bd5\uff0c\u548c\u6df1\u5ea6\u6d4b\u8bd5\u4e00\u6837\uff0c\u662fOpengl\u4e2d\u5e38\u7528\u7684\u6280\u672f\u3002\u6982\u5ff5\u5c31\u4e0d\u89e3\u91ca\u4e86\uff0c\u76f4\u63a5\u6f14\u793a\u7528\u6cd5\u3002\u6211\u4eec\u5b9e\u73b0\u5bf9\u4e00\u4e2a\u7acb\u65b9\u4f53\u76d2\u5b50\u8fdb\u884c\u9ad8\u4eae\u63cf\u8fb9\u3002",date:"2021-12-15T22:13:01.000Z",tags:[{inline:!0,label:"opengl\u57fa\u7840",permalink:"/blog/tags/opengl\u57fa\u7840"},{inline:!0,label:"stencil",permalink:"/blog/tags/stencil"}],readingTime:5.185,hasTruncateMarker:!1,authors:[{name:"\u82cf\u660e\u624d",title:"Vulkan\u9a71\u52a8\u586b\u5751\u72ee",url:"https://github.com/sumcai",email:"sumcai@163.com",page:{permalink:"/blog/authors/sumcai"},description:"\u6709\u4efb\u4f55\u95ee\u9898\uff0c\u8bf7\u8054\u7cfb sumcai@163.com",socials:{github:"https://github.com/sumcai"},imageURL:"https://avatars.githubusercontent.com/u/76768485?v=4",key:"sumcai"}],frontMatter:{title:"Stencil\u7528\u6cd5",categories:["opengl\u6280\u672f"],tags:["opengl\u57fa\u7840","stencil"],date:"2021-12-15T22:13:01.000Z",authors:"sumcai",permalink:"/opengl/stencil/"},unlisted:!1,prevItem:{title:"Blend\u7528\u6cd5",permalink:"/blog/08.Blend\u7528\u6cd5"},nextItem:{title:"MVP\u53d8\u6362\u5750\u6807",permalink:"/blog/06.MVP\u53d8\u6362\u5750\u6807"}},o={authorsImageUrls:[void 0]},c=[{value:"stencil\u7528\u6cd5",id:"stencil\u7528\u6cd5",level:2},{value:"\u793a\u4f8b\u4ee3\u7801",id:"\u793a\u4f8b\u4ee3\u7801",level:2},{value:"\u666e\u901a\u6d41\u7a0b",id:"\u666e\u901a\u6d41\u7a0b",level:3},{value:"\u4f7f\u7528\u6a21\u677f\u6d4b\u8bd5\u529f\u80fd",id:"\u4f7f\u7528\u6a21\u677f\u6d4b\u8bd5\u529f\u80fd",level:3}];function s(n){const r={code:"code",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...n.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(r.p,{children:"opengl\u7684stencil\u79f0\u4e3a\u6a21\u677f\u6d4b\u8bd5\uff0c\u548c\u6df1\u5ea6\u6d4b\u8bd5\u4e00\u6837\uff0c\u662fOpengl\u4e2d\u5e38\u7528\u7684\u6280\u672f\u3002\u6982\u5ff5\u5c31\u4e0d\u89e3\u91ca\u4e86\uff0c\u76f4\u63a5\u6f14\u793a\u7528\u6cd5\u3002\u6211\u4eec\u5b9e\u73b0\u5bf9\u4e00\u4e2a\u7acb\u65b9\u4f53\u76d2\u5b50\u8fdb\u884c\u9ad8\u4eae\u63cf\u8fb9\u3002"}),"\n",(0,l.jsx)(r.h2,{id:"stencil\u7528\u6cd5",children:"stencil\u7528\u6cd5"}),"\n",(0,l.jsx)(r.p,{children:"stencil\u6700\u7b80\u5355\u7684\u7528\u6cd5\u662f\u4f7f\u7528\u4e0b\u9762\u4e09\u4e2a\u51fd\u6570\uff1a"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"glStencilMask(GLuint value)"}),": \u4f4d\u906e\u7f69\uff0c 0x00\u8bbe\u7f6e\u6a21\u677f\u7f13\u51b2\u4e0d\u53ef\u5199\u5165\uff1bvalue=0xFF\u8bbe\u7f6e\u53ef\u4ee5\u5199\u5165\u3002"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"glStencilFunc(GLenum func, GLint ref, GLuint mask)"}),": \u7528ref\u503c\u4e0e\u5b58\u50a8\u7684\u6a21\u677f\u503c\u6bd4\u8f83\uff0cfunc\u4e3a\u6bd4\u8f83\u65b9\u6cd5\u3002"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"glStencilOp(GLenum sfail, GLenum dpfail, GLenum dppass)"}),": \u6a21\u677f\u503c\u7684\u5199\u5165\u7b56\u7565"]}),"\n"]}),"\n",(0,l.jsxs)(r.p,{children:["\u7b80\u5355\u6765\u8bf4\uff0c",(0,l.jsx)(r.code,{children:"glStencilMask"}),"\u662f\u5f00\u5173\uff0c\u5f00\u4e86\u624d\u53ef\u4ee5\u5199\u5165\u6a21\u677f\u503c\uff1b",(0,l.jsx)(r.code,{children:"glStencilFunc"}),"\u662f\u5199\u5165\u6a21\u677f\u503c\u7684\u524d\u63d0\u6761\u4ef6\uff1b",(0,l.jsx)(r.code,{children:"glStencilOp"}),"\u662f\u6a21\u677f\u503c\u7684\u5177\u4f53\u5199\u5165\u65b9\u6cd5\u3002"]}),"\n",(0,l.jsx)(r.h2,{id:"\u793a\u4f8b\u4ee3\u7801",children:"\u793a\u4f8b\u4ee3\u7801"}),"\n",(0,l.jsx)(r.h3,{id:"\u666e\u901a\u6d41\u7a0b",children:"\u666e\u901a\u6d41\u7a0b"}),"\n",(0,l.jsx)(r.p,{children:"\u6211\u4eec\u5148\u51c6\u5907\u597d\u4e86\u753b\u4e00\u4e2a\u7acb\u65b9\u4f53\u76d2\u5b50\u7684\u4ee3\u7801\uff1a"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:'GLuint boxProgramID;\r\n\r\nvoid display( GLFWwindow* window )\r\n{\r\n    glClearColor( 0, 0, 0.4, 0 );\r\n    glClear( GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);\r\n\r\n    // \u8bbe\u7f6e\u597d\u5750\u6807\u53d8\u5316\u7684mvp\r\n    glm::mat4 projection = glm::perspective(glm::radians(45.0f), (float) 5 / (float)5, 0.1f, 100.0f);\r\n    glm::mat4 view = glm::lookAt(glm::vec3(1,2,3), glm::vec3(0,0,0), glm::vec3(0,1,0));\r\n    glm::mat4 model = glm::mat4(1.0f);\r\n    glm::mat4 mvp = projection * view * model;\r\n\r\n    // \u753b\u7acb\u65b9\u4f53\r\n    glUseProgram(boxProgramID);\r\n    GLuint mvpId = glGetUniformLocation(boxProgramID, "MVP");\r\n    glUniformMatrix4fv(mvpId, 1, GL_FALSE, &mvp[0][0]);\r\n    glDrawArrays(GL_TRIANGLES, 0, 36);\r\n}\r\n\r\nvoid prepare() {\r\n    boxProgramID = LoadShaders( "data/shader/03.MVP.vs", "data/shader/03.MVP.fs" );\r\n\r\n    // \u7acb\u65b9\u4f53\u7684\u9876\u70b9\u5750\u6807\uff0c\u7eb9\u7406\u5750\u6807\r\n    const GLfloat g_vertex_buffer_data[] = {\r\n            -0.5f, -0.5f, -0.5f,  0.0f, 0.0f,\r\n            0.5f, -0.5f, -0.5f,  1.0f, 0.0f,\r\n            0.5f,  0.5f, -0.5f,  1.0f, 1.0f,\r\n            0.5f,  0.5f, -0.5f,  1.0f, 1.0f,\r\n            -0.5f,  0.5f, -0.5f,  0.0f, 1.0f,\r\n            -0.5f, -0.5f, -0.5f,  0.0f, 0.0f,\r\n\r\n            -0.5f, -0.5f,  0.5f,  0.0f, 0.0f,\r\n            0.5f, -0.5f,  0.5f,  1.0f, 0.0f,\r\n            0.5f,  0.5f,  0.5f,  1.0f, 1.0f,\r\n            0.5f,  0.5f,  0.5f,  1.0f, 1.0f,\r\n            -0.5f,  0.5f,  0.5f,  0.0f, 1.0f,\r\n            -0.5f, -0.5f,  0.5f,  0.0f, 0.0f,\r\n\r\n            -0.5f,  0.5f,  0.5f,  1.0f, 0.0f,\r\n            -0.5f,  0.5f, -0.5f,  1.0f, 1.0f,\r\n            -0.5f, -0.5f, -0.5f,  0.0f, 1.0f,\r\n            -0.5f, -0.5f, -0.5f,  0.0f, 1.0f,\r\n            -0.5f, -0.5f,  0.5f,  0.0f, 0.0f,\r\n            -0.5f,  0.5f,  0.5f,  1.0f, 0.0f,\r\n\r\n            0.5f,  0.5f,  0.5f,  1.0f, 0.0f,\r\n            0.5f,  0.5f, -0.5f,  1.0f, 1.0f,\r\n            0.5f, -0.5f, -0.5f,  0.0f, 1.0f,\r\n            0.5f, -0.5f, -0.5f,  0.0f, 1.0f,\r\n            0.5f, -0.5f,  0.5f,  0.0f, 0.0f,\r\n            0.5f,  0.5f,  0.5f,  1.0f, 0.0f,\r\n\r\n            -0.5f, -0.5f, -0.5f,  0.0f, 1.0f,\r\n            0.5f, -0.5f, -0.5f,  1.0f, 1.0f,\r\n            0.5f, -0.5f,  0.5f,  1.0f, 0.0f,\r\n            0.5f, -0.5f,  0.5f,  1.0f, 0.0f,\r\n            -0.5f, -0.5f,  0.5f,  0.0f, 0.0f,\r\n            -0.5f, -0.5f, -0.5f,  0.0f, 1.0f,\r\n\r\n            -0.5f,  0.5f, -0.5f,  0.0f, 1.0f,\r\n            0.5f,  0.5f, -0.5f,  1.0f, 1.0f,\r\n            0.5f,  0.5f,  0.5f,  1.0f, 0.0f,\r\n            0.5f,  0.5f,  0.5f,  1.0f, 0.0f,\r\n            -0.5f,  0.5f,  0.5f,  0.0f, 0.0f,\r\n            -0.5f,  0.5f, -0.5f,  0.0f, 1.0f\r\n    };\r\n\r\n    // VAO\u3001VBO\u7684\u6570\u636e\r\n    GLuint VAO1;\r\n    GLuint VBO1;\r\n    glGenVertexArrays(1, &VAO1);\r\n    glBindVertexArray(VAO1);\r\n    glGenBuffers(1, &VBO1);\r\n    glBindBuffer(GL_ARRAY_BUFFER, VBO1);\r\n    glBufferData(GL_ARRAY_BUFFER, sizeof(g_vertex_buffer_data), g_vertex_buffer_data, GL_STATIC_DRAW);\r\n    glEnableVertexAttribArray(0);\r\n    glVertexAttribPointer(0, 3, GL_FLOAT, GL_FALSE, 5 * sizeof(GLfloat), (void*)0);\r\n\r\n    // \u7eb9\u7406\u6570\u636e\r\n    GLuint texture;\r\n    glGenTextures(1, &texture);\r\n    glActiveTexture(GL_TEXTURE0);\r\n    glBindTexture(GL_TEXTURE_2D, texture);\r\n\r\n    // \u73af\u7ed5\u65b9\u5f0f\r\n    glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_REPEAT);\r\n    glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_REPEAT);\r\n    // \u8fc7\u6ee4\u65b9\u5f0f\r\n    glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_NEAREST);\r\n    glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_NEAREST);\r\n    // \u52a0\u8f7d\u56fe\u7247\u6570\u636e\r\n    int width, height, channels;\r\n    stbi_set_flip_vertically_on_load(true);\r\n    unsigned char* data = stbi_load("data/img/test.jpg", &width, &height, &channels, 0);\r\n    glTexImage2D(GL_TEXTURE_2D, 0, GL_RGB, width, height, 0, GL_RGB, GL_UNSIGNED_BYTE, data);\r\n    stbi_image_free(data);\r\n    // \u7eb9\u7406\u5750\u6807\r\n    glEnableVertexAttribArray(1);\r\n    glVertexAttribPointer(1, 2, GL_FLOAT, GL_FALSE, 5 * sizeof(GLfloat), (void*)(3 * sizeof(GLfloat)));\r\n\r\n    glEnable(GL_DEPTH_TEST);\r\n}\r\n\r\nint main( int argc, char** argv )\r\n{\r\n    glfwInit();\r\n    GLFWwindow* window = glfwCreateWindow( 512, 512, "OpenGL_Tutorial", NULL, NULL );\r\n    glfwMakeContextCurrent( window );\r\n    gladLoadGLLoader( (GLADloadproc)glfwGetProcAddress );\r\n    glfwSwapInterval( 1 );\r\n\r\n    glfwSetKeyCallback( window, keyboard );\r\n    glfwSetCursorPosCallback( window, motion );\r\n    glfwSetMouseButtonCallback( window, mouse );\r\n\r\n    prepare();\r\n\r\n    while (!glfwWindowShouldClose(window)) {\r\n        display(window);\r\n        glfwPollEvents();\r\n        glfwSwapBuffers(window);\r\n    }\r\n\r\n    glfwTerminate();\r\n    return 0;\r\n}\n'})}),"\n",(0,l.jsx)(r.p,{children:"\u663e\u793a\u6548\u679c\u5982\u56fe\uff1a"}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{src:"https://objectstorage.ap-osaka-1.oraclecloud.com/n/ax0kqy8quzyr/b/bucket-blog/o/2022/04/f9fd38ae6d0d360aa8b7cb6c3bfe0f0e.png",alt:"1639578757898"})}),"\n",(0,l.jsx)(r.h3,{id:"\u4f7f\u7528\u6a21\u677f\u6d4b\u8bd5\u529f\u80fd",children:"\u4f7f\u7528\u6a21\u677f\u6d4b\u8bd5\u529f\u80fd"}),"\n",(0,l.jsx)(r.p,{children:"\u52a0\u5165\u6a21\u677f\u6d4b\u8bd5\u529f\u80fd\uff0c\u6d41\u7a0b\u63cf\u8ff0\uff1a"}),"\n",(0,l.jsxs)(r.ol,{children:["\n",(0,l.jsx)(r.li,{children:"\u5f00\u542f\u6a21\u677f\u6d4b\u8bd5"}),"\n",(0,l.jsx)(r.li,{children:"\u6e05\u9664\u6240\u6709\u6a21\u677f\u503c"}),"\n",(0,l.jsx)(r.li,{children:"\u753b\u4e00\u4e2a\u7acb\u65b9\u4f53\u76d2\u5b50\uff0c\u5c06\u76d2\u5b50\u533a\u57df\u7684\u6a21\u677f\u503c\u8bbe\u7f6e\u53ef\u5199\uff0c\u503c\u4e3a1"}),"\n",(0,l.jsx)(r.li,{children:"\u753b\u4e00\u4e2a\u7a0d\u5927\u70b9\u7684\u76d2\u5b50(\u76d2\u5b50\u653e\u59271.05\u500d)\uff0c\u4e0d\u8d34\u56fe\uff0cfs\u91cc\u76f4\u63a5\u8bbe\u7f6e\u989c\u8272\u56fa\u5b9a\u503c\uff0c\u8fdb\u884c\u6a21\u677f\u6d4b\u8bd5\uff0c\u6a21\u677f\u6d4b\u8bd5\u6761\u4ef6\u4e3a\u6a21\u677f\u503c != 1\uff0c\u8bbe\u7f6e\u6a21\u677f\u503c\u4e0d\u53ef\u5199\u3002"}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:"\u5177\u4f53\u4ee3\u7801\uff1a"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:'void display( GLFWwindow* window )\r\n{\r\n    // 1.\u5f00\u542fstencil\u529f\u80fd\r\n    glEnable(GL_STENCIL_TEST);\r\n    // \u8bbe\u7f6e\u6a21\u677f\u503c\u53ef\u5199\uff0c\u4e0b\u9762\u7684clear GL_STENCIL_BUFFER_BIT\u64cd\u4f5c\u624d\u80fd\u6267\u884c\r\n    glStencilMask(0xFF);\r\n    // \u8bbe\u7f6e\u6a21\u677f\u6d4b\u8bd5\u6210\u529f\u7684\u5199\u5165\u65b9\u5f0f\u4e3a\u66ff\u6362\uff0c\u5373\u6d4b\u8bd5\u6210\u529f\uff0c\u4f7f\u7528glStencilFunc\u4e2d\u7684ref\u503c\u5199\u5165\u6a21\u677f\u503c\r\n    glStencilOp(GL_KEEP, GL_KEEP, GL_REPLACE);\r\n    glClearColor( 0, 0, 0.4, 0 );\r\n    // 2.\u6e05\u9664\u6df1\u5ea6\u3001\u6a21\u677f\u503c\r\n    glClear( GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT | GL_STENCIL_BUFFER_BIT);\r\n\r\n    // 3.\u753b\u7acb\u65b9\u4f53\r\n    glm::mat4 projection = glm::perspective(glm::radians(45.0f), (float) 5 / (float)5, 0.1f, 100.0f);\r\n    glm::mat4 view = glm::lookAt(glm::vec3(1,2,3), glm::vec3(0,0,0), glm::vec3(0,1,0));\r\n    glm::mat4 model = glm::mat4(1.0f);\r\n    glm::mat4 mvp = projection * view * model;\r\n\r\n    // \u8bbe\u7f6e\u6a21\u677f\u503c\u7684\u5199\u5165\u7b56\u7565\uff0cGL_ALWAYS\u8868\u793a\u65e0\u6761\u4ef6\u5199\u5165\r\n    glStencilFunc(GL_ALWAYS, 1, 0xFF);\r\n    glUseProgram(boxProgramID);\r\n    GLuint mvpId = glGetUniformLocation(boxProgramID, "MVP");\r\n    glUniformMatrix4fv(mvpId, 1, GL_FALSE, &mvp[0][0]);\r\n    glDrawArrays(GL_TRIANGLES, 0, 36);\r\n\r\n    // 4.\u753b\u63cf\u8fb9\r\n    model = glm::mat4(1.0f);\r\n    // \u653e\u5927\u76d2\u5b50\u4e3a\u539f\u6765\u76841.05\u500d\r\n    model = glm::scale(model, glm::vec3(1.05, 1.05, 1.05));\r\n    mvp = projection * view * model;\r\n\r\n    // \u8fdb\u884c\u6a21\u677f\u6d4b\u8bd5\uff0c\u53ea\u6709\u4e0d\u7b49\u4e8e1\u7684\u6a21\u677f\u503c\u624d\u6d4b\u8bd5\u6210\u529f\r\n    glStencilFunc(GL_NOTEQUAL, 1, 0xFF);\r\n    // \u8bbe\u7f6e\u6a21\u677f\u503c\u4e0d\u53ef\u5199\uff0c\u6b64\u5904\u65e0\u9700\u66f4\u65b0\u6a21\u677f\u503c\r\n    glStencilMask(0x00);\r\n    glUseProgram(stencilProgramID);\r\n    mvpId = glGetUniformLocation(stencilProgramID, "MVP");\r\n    glUniformMatrix4fv(mvpId, 1, GL_FALSE, &mvp[0][0]);\r\n    glDrawArrays(GL_TRIANGLES, 0, 36);\r\n\r\n}\n'})}),"\n",(0,l.jsx)(r.p,{children:"\u73b0\u5728\u7684\u6548\u679c\uff1a"}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{src:"https://objectstorage.ap-osaka-1.oraclecloud.com/n/ax0kqy8quzyr/b/bucket-blog/o/2022/04/88e03e838ed2941bffb00b84a0d956da.png",alt:"1639579682967"})})]})}function g(n={}){const{wrapper:r}={...(0,t.R)(),...n.components};return r?(0,l.jsx)(r,{...n,children:(0,l.jsx)(s,{...n})}):s(n)}},8453:(n,r,e)=>{e.d(r,{R:()=>i,x:()=>a});var l=e(6540);const t={},f=l.createContext(t);function i(n){const r=l.useContext(f);return l.useMemo((function(){return"function"==typeof n?n(r):{...r,...n}}),[r,n])}function a(n){let r;return r=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:i(n.components),l.createElement(f.Provider,{value:r},n.children)}}}]);