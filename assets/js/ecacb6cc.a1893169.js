"use strict";(self.webpackChunkvulkan_doc=self.webpackChunkvulkan_doc||[]).push([[7969],{2012:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>_,contentTitle:()=>o,default:()=>c,frontMatter:()=>a,metadata:()=>m,toc:()=>s});var t=i(4848),r=i(8453);const a={title:"\u521b\u5efadepth/stencil attachment",categories:["Vulkan\u6280\u672f"],tags:["\u56fe\u5f62\u57fa\u7840"],date:new Date("2024-08-01T15:47:56.000Z"),authors:"sumcai"},o="\u521b\u5efadepth/stencil attachment",m={permalink:"/blog/14.\u521b\u5efadepthstencil attachment",source:"@site/blog/14.\u521b\u5efadepthstencil attachment.md",title:"\u521b\u5efadepth/stencil attachment",description:"\u521b\u5efa\u8fc7\u7a0b",date:"2024-08-01T15:47:56.000Z",tags:[{inline:!0,label:"\u56fe\u5f62\u57fa\u7840",permalink:"/blog/tags/\u56fe\u5f62\u57fa\u7840"}],readingTime:1.125,hasTruncateMarker:!1,authors:[{name:"\u82cf\u660e\u624d",title:"Vulkan\u9a71\u52a8\u586b\u5751\u72ee",url:"https://github.com/sumcai",email:"sumcai@163.com",page:{permalink:"/blog/authors/sumcai"},description:"\u6709\u4efb\u4f55\u95ee\u9898\uff0c\u8bf7\u8054\u7cfb sumcai@163.com",socials:{github:"https://github.com/sumcai"},imageURL:"https://avatars.githubusercontent.com/u/76768485?v=4",key:"sumcai"}],frontMatter:{title:"\u521b\u5efadepth/stencil attachment",categories:["Vulkan\u6280\u672f"],tags:["\u56fe\u5f62\u57fa\u7840"],date:"2024-08-01T15:47:56.000Z",authors:"sumcai"},unlisted:!1,prevItem:{title:"MipMap\u4e0eLOD\u662f\u4f55\u7269\uff1f",permalink:"/blog/11.MipMap\u4e0eLOD\u662f\u4f55\u7269"},nextItem:{title:"\u521b\u5efamvp ubo",permalink:"/blog/15.\u521b\u5efamvp ubo"}},_={authorsImageUrls:[void 0]},s=[{value:"\u521b\u5efa\u8fc7\u7a0b",id:"\u521b\u5efa\u8fc7\u7a0b",level:2},{value:"\u793a\u4f8b\u4ee3\u7801",id:"\u793a\u4f8b\u4ee3\u7801",level:2}];function l(e){const n={code:"code",h2:"h2",li:"li",ol:"ol",pre:"pre",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"\u521b\u5efa\u8fc7\u7a0b",children:"\u521b\u5efa\u8fc7\u7a0b"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"\u521b\u5efa\u4e00\u4e2adepth/stencil image"}),"\n",(0,t.jsx)(n.li,{children:"\u67e5\u627eimage memory requirements"}),"\n",(0,t.jsx)(n.li,{children:"\u5206\u914d\u3001\u7ed1\u5b9aimage memory"}),"\n",(0,t.jsx)(n.li,{children:"\u8bbe\u7f6eimage layout"}),"\n",(0,t.jsx)(n.li,{children:"\u521b\u5efadepth/stencil imageview"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"\u793a\u4f8b\u4ee3\u7801",children:"\u793a\u4f8b\u4ee3\u7801"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:"VkFormat image_format = VK_FORMAT_D16_UNORM;  //\u652f\u6301depth\\stencil\u7684format\r\nVkImageCreateInfo image_info = {};\r\nVkFormatProperties props;\r\nvkGetPhysicalDeviceFormatProperties(physical_device, image_format, &props);\r\nif (props.linearTilingFeatures & VK_FORMAT_FEATURE_DEPTH_STENCIL_ATTACHMENT_BIT) {\r\n\timage_info.tiling = VK_IMAGE_TILING_LINEAR;\r\n} else if (props.optimalTilingFeatures & VK_FORMAT_FEATURE_DEPTH_STENCIL_ATTACHMENT_BIT) {\r\n\timage_info.tiling = VK_IMAGE_TILING_OPTIMAL;\r\n}\r\n \r\nimage_info.sType = VK_STRUCTURE_TYPE_IMAGE_CREATE_INFO;\r\nimage_info.pNext = NULL;\r\nimage_info.imageType = VK_IMAGE_TYPE_2D;\r\nimage_info.format = image_format;\r\nimage_info.extent.width = 64;\r\nimage_info.extent.height = 64;\r\nimage_info.extent.depth = 1;\r\nimage_info.mipLevels = 1;\r\nimage_info.arrayLayers = 1;\r\nimage_info.samples = VK_SAMPLE_COUNT_1_BIT;\r\nimage_info.initialLayout = VK_IMAGE_LAYOUT_UNDEFINED;\r\nimage_info.usage = VK_IMAGE_USAGE_DEPTH_STENCIL_ATTACHMENT_BIT;\r\nimage_info.queueFamilyIndexCount = 0;\r\nimage_info.pQueueFamilyIndices = NULL;\r\nimage_info.sharingMode = VK_SHARING_MODE_EXCLUSIVE;\r\nimage_info.flags = 0;\r\n \r\nVkImage image;\r\nvkCreateImage(device, &image_info, NULL, &image);\r\n \r\nVkMemoryRequirements mem_reqs;\r\nvkGetImageMemoryRequirements(device, image, &mem_reqs);\r\n \r\nVkMemoryAllocateInfo mem_alloc = {};\r\nmem_alloc.sType = VK_STRUCTURE_TYPE_MEMORY_ALLOCATE_INFO;\r\nmem_alloc.pNext = NULL;\r\nmem_alloc.memoryTypeIndex = 0;\r\nmem_alloc.allocationSize = mem_reqs.size;\r\nVkDeviceMemory mem;\r\nvkAllocateMemory(device, &mem_alloc, NULL, &mem);\r\n \r\nvkBindImageMemory(device, image, mem, 0)\r\n \r\nVkImageView view;\r\nVkImageViewCreateInfo view_info = {};\r\nview_info.sType = VK_STRUCTURE_TYPE_IMAGE_VIEW_CREATE_INFO;\r\nview_info.pNext = NULL;\r\nview_info.image = image;\r\nview_info.format = image_format;\r\nview_info.components.r = VK_COMPONENT_SWIZZLE_R;\r\nview_info.components.g = VK_COMPONENT_SWIZZLE_G;\r\nview_info.components.b = VK_COMPONENT_SWIZZLE_B;\r\nview_info.components.a = VK_COMPONENT_SWIZZLE_A;\r\nview_info.subresourceRange.aspectMask = VK_IMAGE_ASPECT_DEPTH_BIT;  //\u6216\u8005\u662fVK_IMAGE_ASPECT_STENCIL_BIT\r\nview_info.subresourceRange.baseMipLevel = 0;\r\nview_info.subresourceRange.levelCount = 1;\r\nview_info.subresourceRange.baseArrayLayer = 0;\r\nview_info.subresourceRange.layerCount = 1;\r\nview_info.viewType = VK_IMAGE_VIEW_TYPE_2D;\r\nview_info.flags = 0;\r\n \r\nvkCreateImageView(device, &view_info, NULL, &view);\n"})})]})}function c(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>m});var t=i(6540);const r={},a=t.createContext(r);function o(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function m(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);