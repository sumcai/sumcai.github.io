"use strict";(self.webpackChunkvulkan_doc=self.webpackChunkvulkan_doc||[]).push([[8260],{6423:(e,t,l)=>{l.r(t),l.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>a,frontMatter:()=>i,metadata:()=>d,toc:()=>o});var n=l(4848),r=l(8453);const i={title:"Vulkan\u4e2d\u7684HLSL",description:"\u4ecb\u7ecdVulkan\u4e2d\u7684HLSL",date:new Date("2024-10-13T00:00:00.000Z")},s="Vulkan \u4e2d\u7684 HLSL",d={id:"guide/usage/HLSL_in_vulkan",title:"Vulkan\u4e2d\u7684HLSL",description:"\u4ecb\u7ecdVulkan\u4e2d\u7684HLSL",source:"@site/docs/guide/usage/27-HLSL_in_vulkan.md",sourceDirName:"guide/usage",slug:"/guide/usage/HLSL_in_vulkan",permalink:"/guide/usage/HLSL_in_vulkan",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:27,frontMatter:{title:"Vulkan\u4e2d\u7684HLSL",description:"\u4ecb\u7ecdVulkan\u4e2d\u7684HLSL",date:"2024-10-13T00:00:00.000Z"},sidebar:"VulkanGuide",previous:{title:"Vulkan \u7684\u5e38\u89c1\u9677\u9631",permalink:"/guide/usage/new_developer"}},c={},o=[{value:"\u5b66\u4e60\u8d44\u6e90",id:"\u5b66\u4e60\u8d44\u6e90",level:2},{value:"\u4ece\u5e94\u7528\u7a0b\u5e8f\u7684\u89d2\u5ea6\u6765\u770b",id:"\u4ece\u5e94\u7528\u7a0b\u5e8f\u7684\u89d2\u5ea6\u6765\u770b",level:2},{value:"HLSL \u5230 SPIR-V \u529f\u80fd\u5bf9\u7167\u624b\u518c",id:"hlsl-\u5230-spir-v-\u529f\u80fd\u5bf9\u7167\u624b\u518c",level:2},{value:"Vulkan HLSL \u547d\u540d\u7a7a\u95f4",id:"vulkan-hlsl-\u547d\u540d\u7a7a\u95f4",level:2},{value:"\u8bed\u6cd5\u6bd4\u8f83",id:"\u8bed\u6cd5\u6bd4\u8f83",level:2},{value:"GLSL",id:"glsl",level:3},{value:"HLSL",id:"hlsl",level:3},{value:"DirectXShaderCompiler \uff08DXC\uff09",id:"directxshadercompiler-dxc",level:2},{value:"\u83b7\u53d6\u9014\u5f84",id:"\u83b7\u53d6\u9014\u5f84",level:3},{value:"\u4f7f\u7528\u72ec\u7acb\u7f16\u8bd1\u5668\u79bb\u7ebf\u7f16\u8bd1",id:"\u4f7f\u7528\u72ec\u7acb\u7f16\u8bd1\u5668\u79bb\u7ebf\u7f16\u8bd1",level:3},{value:"\u4f7f\u7528\u5e93\u8fd0\u884c\u65f6\u7f16\u8bd1",id:"\u4f7f\u7528\u5e93\u8fd0\u884c\u65f6\u7f16\u8bd1",level:3},{value:"Vulkan \u7740\u8272\u5668\u9636\u6bb5\u5230 HLSL \u7684\u914d\u7f6e\u6620\u5c04\u6587\u4ef6",id:"vulkan-\u7740\u8272\u5668\u9636\u6bb5\u5230-hlsl-\u7684\u914d\u7f6e\u6620\u5c04\u6587\u4ef6",level:3},{value:"\u7740\u8272\u5668\u6a21\u578b\u8986\u76d6\u8303\u56f4",id:"\u7740\u8272\u5668\u6a21\u578b\u8986\u76d6\u8303\u56f4",level:2}];function h(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.header,{children:(0,n.jsx)(t.h1,{id:"vulkan-\u4e2d\u7684-hlsl",children:"Vulkan \u4e2d\u7684 HLSL"})}),"\n",(0,n.jsxs)(t.p,{children:["Vulkan \u4f7f\u7528\u7684\u7740\u8272\u5668\u4e0d\u662f\u53ef\u8bfb\u7684\u6587\u672c\u683c\u5f0f\uff0c\u800c\u662f ",(0,n.jsx)(t.a,{href:"https://docs.vulkan.org/guide/latest/what_is_spirv.html",children:"SPIR-V"})," \u683c\u5f0f\uff0c\u4e0d\u4ec5\u4ec5GLSL\uff0c\u5176\u4ed6\u7740\u8272\u5668\u8bed\u8a00\u53ea\u8981\u53ef\u4ee5\u8f6c\u5316\u6210Vulkan SPIR-V\uff0c\u90a3\u90fd\u53ef\u4ee5\u4f7f\u7528\u3002"]}),"\n",(0,n.jsxs)(t.p,{children:["\u5176\u4e2d\u4e00\u79cd\u8bed\u8a00\u662f DirectX \u4f7f\u7528\u7684\u9ad8\u7ea7\u7740\u8272\u8bed\u8a00 \uff08HLSL\uff09\u3002\u7531\u4e8e ",(0,n.jsx)(t.a,{href:"https://www.khronos.org/blog/hlsl-first-class-vulkan-shading-language",children:"Vulkan 1.2 \u6700\u8fd1\u6dfb\u52a0\u4e86"}),"\u4e00\u4e9b\u529f\u80fd\uff0c\u5b83\u73b0\u5728\u662f Vulkan \u7b2c\u4e00\u68af\u961f\u7684\u7740\u8272\u5668\u8bed\u8a00\uff0c\u53ef\u4ee5\u50cf GLSL \u4e00\u6837\u8f7b\u677e\u4f7f\u7528\u3002"]}),"\n",(0,n.jsxs)(t.p,{children:["\u9664\u4e86",(0,n.jsx)(t.a,{href:"https://github.com/microsoft/DirectXShaderCompiler/blob/main/docs/SPIR-V.rst#unsupported-hlsl-features",children:"\u5c11\u6570\u4f8b\u5916\u60c5\u51b5"}),"\uff0cGLSL \u63d0\u4f9b\u7684\u6240\u6709 Vulkan \u529f\u80fd\u548c\u7740\u8272\u5668\u9636\u6bb5\u540c\u6837\u9002\u7528\u4e8e HLSL\uff0c\u5305\u62ec\u6700\u8fd1\u6dfb\u52a0\u7684 Vulkan \u529f\u80fd\uff0c\u5982\u901a\u8fc7\u786c\u4ef6\u52a0\u901f\u7684\u5149\u7ebf\u8ffd\u8e2a\u3002\u53e6\u4e00\u65b9\u9762\uff0cHLSL\u8f6c\u5316\u7684SPIR-V \u652f\u6301 DirectX \u4e2d\u5c1a\u672a\u63d0\u4f9b\u7684 Vulkan \u7684\u72ec\u6709\u529f\u80fd\u3002"]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"what_is_spriv_dxc.png",src:l(6032).A+"",width:"413",height:"455"})}),"\n",(0,n.jsx)(t.h2,{id:"\u5b66\u4e60\u8d44\u6e90",children:"\u5b66\u4e60\u8d44\u6e90"}),"\n",(0,n.jsxs)(t.p,{children:["\u5982\u679c\u4f60\u4e0d\u719f\u6089 HLSL\uff0c\u6700\u597d\u4ece ",(0,n.jsx)(t.a,{href:"https://learn.microsoft.com/en-us/windows/win32/direct3dhlsl/dx-graphics-hlsl",children:"Microsoft Learn"})," \u4e0a\u7684 HLSL \u8d44\u6e90\u5f00\u59cb\u3002\u53e6\u4e00\u4e2a\u5f88\u597d\u7684\u8d44\u6e90\u662f ",(0,n.jsx)(t.a,{href:"https://microsoft.github.io/DirectX-Specs/",children:"DirectX-Specs \u6587\u6863"}),"\u3002\u5b83\u5305\u542b\u4e86HLSL\u7684\u6700\u65b0\u7740\u8272\u5668\u529f\u80fd\u548c\u7740\u8272\u5668\u6a21\u578b\u7684\u5185\u5bb9\u3002"]}),"\n",(0,n.jsx)(t.h2,{id:"\u4ece\u5e94\u7528\u7a0b\u5e8f\u7684\u89d2\u5ea6\u6765\u770b",children:"\u4ece\u5e94\u7528\u7a0b\u5e8f\u7684\u89d2\u5ea6\u6765\u770b"}),"\n",(0,n.jsx)(t.p,{children:"\u4ece\u5e94\u7528\u7a0b\u5e8f\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u4f7f\u7528 HLSL \u4e0e\u4f7f\u7528 GLSL \u5b8c\u5168\u76f8\u540c\u3002\u7531\u4e8e\u5e94\u7528\u7a0b\u5e8f\u59cb\u7ec8\u4f7f\u7528 SPIR-V \u683c\u5f0f\u7684\u7740\u8272\u5668\uff0c\u56e0\u6b64\u552f\u4e00\u7684\u533a\u522b\u5728\u4e8e\u7740\u8272\u8bed\u8a00\u751f\u6210 SPIR-V \u7740\u8272\u5668\u4f7f\u7528\u7684\u5de5\u5177\u3002"}),"\n",(0,n.jsx)(t.h2,{id:"hlsl-\u5230-spir-v-\u529f\u80fd\u5bf9\u7167\u624b\u518c",children:"HLSL \u5230 SPIR-V \u529f\u80fd\u5bf9\u7167\u624b\u518c"}),"\n",(0,n.jsxs)(t.p,{children:["\u5728 Vulkan \u4e2d\u4f7f\u7528 HLSL \u7684\u4e00\u4e2a\u5f88\u597d\u7684\u53c2\u8003\u662f ",(0,n.jsx)(t.a,{href:"https://github.com/microsoft/DirectXShaderCompiler/blob/main/docs/SPIR-V.rst",children:"HLSL \u5230 SPIR-V \u529f\u80fd\u5bf9\u7167\u624b\u518c"}),"\u3002\u5b83\u5305\u542b\u8bed\u4e49\u3001\u8bed\u6cd5\u3001\u652f\u6301\u7684\u529f\u80fd\u548c\u6269\u5c55\u7b49\u8be6\u7ec6\u7684\u4fe1\u606f\uff0c\u662f\u5fc5\u8bfb\u7684\u3002",(0,n.jsx)(t.a,{href:"https://docs.vulkan.org/guide/latest/decoder_ring.html",children:"decoder ring"}),"\u8fd8\u6709\u4e00\u4e2a\u7ffb\u8bd1\u9875\u9762\uff0c\u5305\u542b\u4e86Vulkan \u548c DirectX \u4e2d\u4f7f\u7528\u7684\u6982\u5ff5\u548c\u672f\u8bed\u3002"]}),"\n",(0,n.jsx)(t.h2,{id:"vulkan-hlsl-\u547d\u540d\u7a7a\u95f4",children:"Vulkan HLSL \u547d\u540d\u7a7a\u95f4"}),"\n",(0,n.jsxs)(t.p,{children:["\u4e3a\u4e86\u4f7f HLSL \u4e0e Vulkan \u517c\u5bb9\uff0c\u5f15\u5165\u4e86\u4e00\u4e2a",(0,n.jsx)(t.a,{href:"https://github.com/microsoft/DirectXShaderCompiler/blob/main/docs/SPIR-V.rst#the-implicit-vk-namespace",children:"\u9690\u5f0f\u547d\u540d\u7a7a\u95f4"}),"\uff0c\u4e3a Vulkan \u7279\u5b9a\u7684\u529f\u80fd\u63d0\u4f9b\u63a5\u53e3\u3002"]}),"\n",(0,n.jsx)(t.h2,{id:"\u8bed\u6cd5\u6bd4\u8f83",children:"\u8bed\u6cd5\u6bd4\u8f83"}),"\n",(0,n.jsx)(t.p,{children:"\u4e0e\u5e38\u89c4\u7f16\u7a0b\u8bed\u8a00\u7c7b\u4f3c\uff0cHLSL \u548c GLSL \u7684\u8bed\u6cd5\u4e0d\u540c\u3002GLSL \u66f4\u6ce8\u91cd\u8fc7\u7a0b\uff08\u50cf C\uff09\uff0c\u800c HLSL \u66f4\u6ce8\u91cd\u5bf9\u8c61\uff08\u50cf C++\uff09\u3002"}),"\n",(0,n.jsx)(t.p,{children:"\u4ee5\u4e0b\u662f\u7528\u4e24\u79cd\u8bed\u8a00\u7f16\u5199\u7684\u76f8\u540c\u529f\u80fd\u7684\u7740\u8272\u5668\uff0c\u5feb\u901f\u6bd4\u8f83\u5b83\u4eec\u7684\u57fa\u672c\u5dee\u5f02\uff0c\u5305\u62ec\u547d\u540d\u7a7a\u95f4\uff0c\u6dfb\u52a0\u663e\u5f0f\u4f4d\u7f6e\uff1a"}),"\n",(0,n.jsx)(t.h3,{id:"glsl",children:"GLSL"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-glsl",children:"#version 450\n\nlayout (location = 0) in vec3 inPosition;\nlayout (location = 1) in vec3 inColor;\n\nlayout (binding = 0) uniform UBO\n{\n\tmat4 projectionMatrix;\n\tmat4 modelMatrix;\n\tmat4 viewMatrix;\n} ubo;\n\nlayout (location = 0) out vec3 outColor;\n\nvoid main()\n{\n\toutColor = inColor * float(gl_VertexIndex);\n\tgl_Position = ubo.projectionMatrix * ubo.viewMatrix * ubo.modelMatrix * vec4(inPosition.xyz, 1.0);\n}\n"})}),"\n",(0,n.jsx)(t.h3,{id:"hlsl",children:"HLSL"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-hlsl",children:"struct VSInput\n{\n[[vk::location(0)]] float3 Position : POSITION0;\n[[vk::location(1)]] float3 Color : COLOR0;\n};\n\nstruct UBO\n{\n\tfloat4x4 projectionMatrix;\n\tfloat4x4 modelMatrix;\n\tfloat4x4 viewMatrix;\n};\n\ncbuffer ubo : register(b0, space0) { UBO ubo; }\n\nstruct VSOutput\n{\n\tfloat4 Pos : SV_POSITION;\n[[vk::location(0)]] float3 Color : COLOR0;\n};\n\nVSOutput main(VSInput input, uint VertexIndex : SV_VertexID)\n{\n\tVSOutput output = (VSOutput)0;\n\toutput.Color = input.Color * float(VertexIndex);\n\toutput.Position = mul(ubo.projectionMatrix, mul(ubo.viewMatrix, mul(ubo.modelMatrix, float4(input.Position.xyz, 1.0))));\n\treturn output;\n}\n"})}),"\n",(0,n.jsxs)(t.p,{children:["\u9664\u4e86\u8bed\u6cd5\u5dee\u5f02\u4e4b\u5916\uff0c\u5185\u7f6e\u53d8\u91cf\u7684\u540d\u79f0\u4e5f\u6709\u5dee\u5f02\uff0c\u4f8b\u5982",(0,n.jsx)(t.code,{children:"gl_vertex"}),"\u5728 HLSL\u4e2d\u662f`VertexIndex\uff0c\u53c2\u9605",(0,n.jsx)(t.a,{href:"(https://anteru.net/blog/2016/mapping-between-HLSL-and-GLSL/)",children:"GLSL \u5230 HLSL \u5185\u7f6e\u53d8\u91cf\u6620\u5c04\u8868"}),"\u3002"]}),"\n",(0,n.jsx)(t.h2,{id:"directxshadercompiler-dxc",children:"DirectXShaderCompiler \uff08DXC\uff09"}),"\n",(0,n.jsxs)(t.p,{children:["\u4e0e GLSL \u5230 SPIR-V \u7684\u60c5\u51b5\u4e00\u6837\uff0c\u8981\u5c06 HLSL \u4e0e Vulkan \u4e00\u8d77\u4f7f\u7528\uff0c\u9700\u8981\u4e00\u4e2a\u7740\u8272\u5668\u7f16\u8bd1\u5668\u3002",(0,n.jsx)(t.a,{href:"https://github.com/KhronosGroup/glslang",children:"glslang"})," \u662f GLSL \u5230 SPIR-V \u4f7f\u7528\u7684\u7f16\u8bd1\u5668\uff0c\u800c ",(0,n.jsx)(t.a,{href:"https://github.com/microsoft/DirectXShaderCompiler",children:"DirectXShaderCompiler"})," \uff08DXC\uff09 \u662f HLSL \u5230 SPIR-V \u7684\u7f16\u8bd1\u5668\u3002\u7531\u4e8e\u5f00\u6e90\u7684\u8d21\u732e\uff0cDXC \u7684 SPIR-V \u540e\u7aef\u73b0\u5728\u5df2\u7ecf\u5305\u542b\u5728\u5b98\u65b9\u53d1\u884c\u7248\u4e2d\uff0c\u5e76\u4e14\u53ef\u4ee5\u5f00\u7bb1\u5373\u7528\u3002\u867d\u7136 ",(0,n.jsx)(t.a,{href:"https://github.com/KhronosGroup/glslang/wiki/HLSL-FAQ",children:"glslang"})," \u7b49\u5176\u4ed6\u7740\u8272\u5668\u7f16\u8bd1\u5de5\u5177\u4e5f\u652f\u6301HLSL\uff0c\u4f46 DXC \u5177\u6709\u6700\u5b8c\u6574\u548c\u6700\u65b0\u7684\u652f\u6301\uff0c\u63a8\u8350\u4f7f\u7528\u5b83\u5c06 HLSL \u751f\u6210 SPIR-V\u3002"]}),"\n",(0,n.jsx)(t.h3,{id:"\u83b7\u53d6\u9014\u5f84",children:"\u83b7\u53d6\u9014\u5f84"}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.a,{href:"https://vulkan.lunarg.com/",children:"LunarG Vulkan SDK"})," \u5305\u62ec\u9884\u7f16\u8bd1\u7684 DXC \u4e8c\u8fdb\u5236\u6587\u4ef6\u3001\u5e93\u548c\u6807\u5934\u3002\u5982\u679c\u60a8\u6b63\u5728\u5bfb\u627e\u6700\u65b0\u7248\u672c\uff0c\u8bf7\u67e5\u770b",(0,n.jsx)(t.a,{href:"https://github.com/microsoft/DirectXShaderCompiler/releases",children:"\u5b98\u65b9 DXC \u5b58\u50a8\u5e93"}),"\u3002"]}),"\n",(0,n.jsx)(t.h3,{id:"\u4f7f\u7528\u72ec\u7acb\u7f16\u8bd1\u5668\u79bb\u7ebf\u7f16\u8bd1",children:"\u4f7f\u7528\u72ec\u7acb\u7f16\u8bd1\u5668\u79bb\u7ebf\u7f16\u8bd1"}),"\n",(0,n.jsx)(t.p,{children:"\u901a\u8fc7dxc \u79bb\u7ebf\u7f16\u8bd1\u7740\u8272\u5668\u4e0e\u4f7f\u7528 glslang \u8fdb\u884c\u7f16\u8bd1\u7c7b\u4f3c\uff1a"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-none",children:"dxc.exe -spirv -T vs_6_0 -E main .\\triangle.vert -Fo .\\triangle.vert.spv\n"})}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.code,{children:"-T"}),"\u7f16\u8bd1\u7740\u8272\u5668\u7684\u914d\u7f6e\u6587\u4ef6\uff08",(0,n.jsx)(t.code,{children:"vs_6_0"}),"= \u9876\u70b9\u7740\u8272\u5668\u6a21\u578b 6\u3001",(0,n.jsx)(t.code,{children:"ps_6_0"}),"= \u50cf\u7d20/\u7247\u6bb5\u7740\u8272\u5668\u6a21\u578b 6 \u7b49\uff09\u3002"]}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.code,{children:"-E"}),"\u7740\u8272\u5668\u7684\u4e3b\u5165\u53e3\u51fd\u6570\u3002"]}),"\n",(0,n.jsx)(t.p,{children:"\u6269\u5c55\u662f\u6839\u636e\u4f7f\u7528\u7684\u529f\u80fd\u9690\u5f0f\u542f\u7528\u7684\uff0c\u4e5f\u53ef\u4ee5\u663e\u5f0f\u6307\u5b9a\uff1a"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-none",children:"dxc.exe -spirv -T vs_6_1 -E main .\\input.vert -Fo .\\output.vert.spv -fspv-extension=SPV_EXT_descriptor_indexing\n"})}),"\n",(0,n.jsx)(t.p,{children:"\u540e\u9762\u5c31\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u5f97\u5230\u7684 SPIR-V\uff0c\u4e0e\u4ece GLSL \u751f\u6210\u7684 SPIR-V \u4e00\u6837\u3002"}),"\n",(0,n.jsx)(t.h3,{id:"\u4f7f\u7528\u5e93\u8fd0\u884c\u65f6\u7f16\u8bd1",children:"\u4f7f\u7528\u5e93\u8fd0\u884c\u65f6\u7f16\u8bd1"}),"\n",(0,n.jsxs)(t.p,{children:["\u8fd8\u53ef\u4ee5\u4f7f\u7528 DirectX \u7f16\u8bd1\u5668 API \u96c6\u6210DXC\u5230 Vulkan \u5e94\u7528\u7a0b\u5e8f\u4e2d\uff0c\u8fd9\u53ef\u4ee5\u8ba9\u7740\u8272\u5668\u8fdb\u884c\u8fd0\u884c\u65f6\u7f16\u8bd1\u3002\u5e94\u7528\u9700\u8981\u5305\u542b",(0,n.jsx)(t.code,{children:"dxcapi.h"}),"\u5934\u6587\u4ef6\u548c\u94fe\u63a5",(0,n.jsx)(t.code,{children:"dxcompiler"}),"\u5e93\u6765\u96c6\u6210\u3002\u6700\u7b80\u5355\u7684\u65b9\u6cd5\u662f\u4f7f\u7528\u52a8\u6001\u5e93\u5e76\u5c06\u5176\u4e0e\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u4e00\u8d77\u5206\u53d1\uff08\u4f8b\u5982 Windows \u4e0a\u7684",(0,n.jsx)(t.code,{children:"dxcompiler.dll"}),"\uff09\u3002"]}),"\n",(0,n.jsx)(t.p,{children:"\u5728\u8fd0\u884c\u65f6\u5c06 HLSL \u7f16\u8bd1\u4e3a SPIR-V \u975e\u5e38\u7b80\u5355\uff1a"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-cpp",children:'#include "include/dxc/dxcapi.h"\n\n...\n\nHRESULT hres;\n\n// Initialize DXC library\nCComPtr<IDxcLibrary> library;\nhres = DxcCreateInstance(CLSID_DxcLibrary, IID_PPV_ARGS(&library));\nif (FAILED(hres)) {\n\tthrow std::runtime_error("Could not init DXC Library");\n}\n\n// Initialize DXC compiler\nCComPtr<IDxcCompiler3> compiler;\nhres = DxcCreateInstance(CLSID_DxcCompiler, IID_PPV_ARGS(&compiler));\nif (FAILED(hres)) {\n\tthrow std::runtime_error("Could not init DXC Compiler");\n}\n\n// Initialize DXC utility\nCComPtr<IDxcUtils> utils;\nhres = DxcCreateInstance(CLSID_DxcUtils, IID_PPV_ARGS(&utils));\nif (FAILED(hres)) {\n\tthrow std::runtime_error("Could not init DXC Utiliy");\n}\n\n// Load the HLSL text shader from disk\nuint32_t codePage = DXC_CP_ACP;\nCComPtr<IDxcBlobEncoding> sourceBlob;\nhres = utils->LoadFile(filename.c_str(), &codePage, &sourceBlob);\nif (FAILED(hres)) {\n\tthrow std::runtime_error("Could not load shader file");\n}\n\n// Select target profile based on shader file extension\nLPCWSTR targetProfile{};\nsize_t idx = filename.rfind(\'.\');\nif (idx != std::string::npos) {\n\tstd::wstring extension = filename.substr(idx + 1);\n\tif (extension == L"vert") {\n\t\ttargetProfile = L"vs_6_1";\n\t}\n\tif (extension == L"frag") {\n\t\ttargetProfile = L"ps_6_1";\n\t}\n\t// Mapping for other file types go here (cs_x_y, lib_x_y, etc.)\n}\n\n// Configure the compiler arguments for compiling the HLSL shader to SPIR-V\nstd::vector<LPCWSTR> arguments = {\n\t// (Optional) name of the shader file to be displayed e.g. in an error message\n\tfilename.c_str(),\n\t// Shader main entry point\n\tL"-E", L"main",\n\t// Shader target profile\n\tL"-T", targetProfile,\n\t// Compile to SPIRV\n\tL"-spirv"\n};\n\n// Compile shader\nDxcBuffer buffer{};\nbuffer.Encoding = DXC_CP_ACP;\nbuffer.Ptr = sourceBlob->GetBufferPointer();\nbuffer.Size = sourceBlob->GetBufferSize();\n\nCComPtr<IDxcResult> result{ nullptr };\nhres = compiler->Compile(\n\t&buffer,\n\targuments.data(),\n\t(uint32_t)arguments.size(),\n\tnullptr,\n\tIID_PPV_ARGS(&result));\n\nif (SUCCEEDED(hres)) {\n\tresult->GetStatus(&hres);\n}\n\n// Output error if compilation failed\nif (FAILED(hres) && (result)) {\n\tCComPtr<IDxcBlobEncoding> errorBlob;\n\thres = result->GetErrorBuffer(&errorBlob);\n\tif (SUCCEEDED(hres) && errorBlob) {\n\t\tstd::cerr << "Shader compilation failed :\\n\\n" << (const char*)errorBlob->GetBufferPointer();\n\t\tthrow std::runtime_error("Compilation failed");\n\t}\n}\n\n// Get compilation result\nCComPtr<IDxcBlob> code;\nresult->GetResult(&code);\n\n// Create a Vulkan shader module from the compilation result\nVkShaderModuleCreateInfo shaderModuleCI{};\nshaderModuleCI.sType = VK_STRUCTURE_TYPE_SHADER_MODULE_CREATE_INFO;\nshaderModuleCI.codeSize = code->GetBufferSize();\nshaderModuleCI.pCode = (uint32_t*)code->GetBufferPointer();\nVkShaderModule shaderModule;\nvkCreateShaderModule(device, &shaderModuleCI, nullptr, &shaderModule);\n'})}),"\n",(0,n.jsx)(t.h3,{id:"vulkan-\u7740\u8272\u5668\u9636\u6bb5\u5230-hlsl-\u7684\u914d\u7f6e\u6620\u5c04\u6587\u4ef6",children:"Vulkan \u7740\u8272\u5668\u9636\u6bb5\u5230 HLSL \u7684\u914d\u7f6e\u6620\u5c04\u6587\u4ef6"}),"\n",(0,n.jsx)(t.p,{children:"\u4f7f\u7528 DXC \u7f16\u8bd1 HLSL \u65f6\uff0c\u9700\u8981\u9009\u62e9\u76ee\u6807\u7740\u8272\u5668\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u914d\u7f6e\u6587\u4ef6\u7684\u540d\u79f0\u7531\u7740\u8272\u5668\u7c7b\u578b\u548c\u7740\u8272\u5668\u6a21\u578b\u7ec4\u6210\u3002"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Vulkan \u7740\u8272\u5668\u9636\u6bb5"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"HLSL \u76ee\u6807\u7740\u8272\u5668\u914d\u7f6e\u6587\u4ef6"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"\u8a00\u8bba"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"VK_SHADER_STAGE_VERTEX_BIT"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"vs"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"VK_SHADER_STAGE_TESSELLATION_CONTROL_BIT"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"hs"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["HLSL \u4e2d\u7684",(0,n.jsx)(t.code,{children:"Hull shader"})]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"VK_SHADER_STAGE_TESSELLATION_EVALUATION_BIT"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"ds"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["HLSL \u4e2d\u7684",(0,n.jsx)(t.code,{children:"Domain shader"})]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"VK_SHADER_STAGE_GEOMETRY_BIT"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"gs"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"VK_SHADER_STAGE_FRAGMENT_BIT"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"ps"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["HLSL \u4e2d\u7684",(0,n.jsx)(t.code,{children:"Pixel shader"})]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"VK_SHADER_STAGE_COMPUTE_BIT"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"cs"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,n.jsx)(t.code,{children:"VK_SHADER_STAGE_RAYGEN_BIT_KHR"}),",",(0,n.jsx)("br",{}),(0,n.jsx)(t.code,{children:"VK_SHADER_STAGE_ANY_HIT_BIT_KHR"}),",",(0,n.jsx)("br",{}),(0,n.jsx)(t.code,{children:"VK_SHADER_STAGE_CLOSEST_HIT_BIT_KHR"}),", ",(0,n.jsx)("br",{}),(0,n.jsx)(t.code,{children:"VK_SHADER_STAGE_MISS_BIT_KHR"}),",",(0,n.jsx)("br",{}),(0,n.jsx)(t.code,{children:"VK_SHADER_STAGE_INTERSECTION_BIT_KHR"}),",",(0,n.jsx)("br",{}),(0,n.jsx)(t.code,{children:"VK_SHADER_STAGE_CALLABLE_BIT_KHR"})]}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"lib"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["\u6240\u6709\u4e0e\u5149\u7ebf\u8ddf\u8e2a\u76f8\u5173\u7684\u7740\u8272\u5668\u90fd\u662f\u4f7f\u7528",(0,n.jsx)(t.code,{children:"lib"}),"\u7740\u8272\u5668\u76ee\u6807\u914d\u7f6e\u6587\u4ef6\u6784\u5efa\u7684\uff0c\u5e76\u4e14\u5fc5\u987b\u81f3\u5c11\u4f7f\u7528\u7740\u8272\u5668\u6a21\u578b 6.3\uff08\u4f8b\u5982",(0,n.jsx)(t.code,{children:"lib_6_3"}),"\uff09\u3002"]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"VK_SHADER_STAGE_TASK_BIT"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"as"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["HLSL \u4e2d\u7684",(0,n.jsx)(t.code,{children:"Amplification shader"}),"\u3002\u5fc5\u987b\u81f3\u5c11\u4f7f\u7528 shader model 6.5\uff08\u4f8b\u5982",(0,n.jsx)(t.code,{children:"as_6_5"}),"\uff09\u3002"]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"VK_SHADER_STAGE_MESH_BIT"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"ms"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["\u5fc5\u987b\u81f3\u5c11\u4f7f\u7528 shader model 6.5\uff08\u4f8b\u5982",(0,n.jsx)(t.code,{children:"ms_6_5"})," \uff09\u3002"]})]})]})]}),"\n",(0,n.jsxs)(t.p,{children:["\u56e0\u6b64\uff0c\u5982\u679c\u8981\u7f16\u8bd1\u7740\u8272\u5668\u6a21\u578b 6.6 \u529f\u80fd\u7684\u8ba1\u7b97\u7740\u8272\u5668\uff0c\u5219\u76ee\u6807\u7740\u8272\u5668\u914d\u7f6e\u6587\u4ef6\u5c06\u662f",(0,n.jsx)(t.code,{children:"cs_6_6"}),"\uff0c\u5149\u7ebf\u8ffd\u8e2a\u7684\u7740\u8272\u5668\u90fd\u662f",(0,n.jsx)(t.code,{children:"lib_6_3"})," \u3002"]}),"\n",(0,n.jsx)(t.h2,{id:"\u7740\u8272\u5668\u6a21\u578b\u8986\u76d6\u8303\u56f4",children:"\u7740\u8272\u5668\u6a21\u578b\u8986\u76d6\u8303\u56f4"}),"\n",(0,n.jsx)(t.p,{children:"DirectX \u548c HLSL \u4f7f\u7528\u56fa\u5b9a\u7684\u7740\u8272\u5668\u6a21\u578b\u6765\u63cf\u8ff0\u652f\u6301\u7684\u529f\u80fd\u96c6\uff0c\u8fd9\u4e0e Vulkan \u548c SPIR-V \u5728\u7740\u8272\u5668\u4e2d\u7075\u6d3b\u6dfb\u52a0\u6269\u5c55\u529f\u80fd\u7684\u65b9\u5f0f\u6709\u6240\u4e0d\u540c\u3002\u4e0b\u8868\u5217\u51fa\u4e86 Vulkan \u5bf9 HLSL \u7740\u8272\u5668\u6a21\u578b\u7684\u8986\u76d6\u8303\u56f4\uff0c\u4f46\u4e0d\u4fdd\u8bc1\u5b8c\u6574\uff1a"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"\u7740\u8272\u5668\u6a21\u578b"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"\u652f\u6301\u60c5\u51b5"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"\u5907\u6ce8"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"\u7740\u8272\u5668\u6a21\u578b 5.1 \u53ca\u66f4\u4f4e\u7248\u672c"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"\u2714"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"\u6392\u9664\u6ca1\u6709 Vulkan \u7b49\u6548\u9879\u7684\u529f\u80fd"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.a,{href:"https://github.com/microsoft/DirectXShaderCompiler/wiki/Shader-Model-6.0",children:"\u7740\u8272\u5668\u6a21\u578b 6.0"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"\u2714"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Wave \u5185\u90e8\u51fd\u6570\uff0c64 \u4f4d\u6574\u6570"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.a,{href:"https://github.com/microsoft/DirectXShaderCompiler/wiki/Shader-Model-6.1",children:"\u7740\u8272\u5668\u6a21\u578b 6.1"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"\u2714"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"SV_ViewID\u3001SV_Barycentrics"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.a,{href:"https://github.com/microsoft/DirectXShaderCompiler/wiki/Shader-Model-6.2",children:"\u7740\u8272\u5668\u6a21\u578b 6.2"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"\u2714"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"16 \u4f4d\u7c7b\u578b\uff0cDenorm \u6a21\u5f0f"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.a,{href:"https://github.com/microsoft/DirectXShaderCompiler/wiki/Shader-Model-6.3",children:"\u7740\u8272\u5668\u6a21\u578b 6.3"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"\u2714"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"\u786c\u4ef6\u52a0\u901f\u5149\u7ebf\u8ffd\u8e2a"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.a,{href:"https://github.com/microsoft/DirectXShaderCompiler/wiki/Shader-Model-6.4",children:"\u7740\u8272\u5668\u6a21\u578b 6.4"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"\u2714"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"\u7740\u8272\u5668\u6574\u6570\u70b9\u79ef\uff0cSV_ShadingRate"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.a,{href:"https://github.com/microsoft/DirectXShaderCompiler/wiki/Shader-Model-6.5",children:"\u7740\u8272\u5668\u6a21\u578b 6.5"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"\u26a0\ufe0f \uff08\u90e8\u5206\uff09"}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["DXR1.1\uff08KHR \u5149\u7ebf\u8ffd\u8e2a\uff09\u3001",(0,n.jsx)("br",{}),"Mesh\u548cAmplification\u7740\u8272\u5668\u3001",(0,n.jsx)("br",{}),"\u5176\u4ed6 Wave \u5185\u90e8\u51fd\u6570"]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.a,{href:"https://github.com/microsoft/DirectXShaderCompiler/wiki/Shader-Model-6.6",children:"\u7740\u8272\u5668\u6a21\u578b 6.6"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"\u26a0\ufe0f \uff08\u90e8\u5206\uff09"}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["VK_NV_compute_shader_derivatives\u3001",(0,n.jsx)("br",{}),"VK_KHR_shader_atomic_int64\u3001",(0,n.jsx)("br",{}),"VK_EXT_descriptor_buffer\u3001",(0,n.jsx)("br",{})," VK_EXT_mutable_descriptor_type"]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.a,{href:"https://microsoft.github.io/DirectX-Specs/d3d/HLSL_ShaderModel6_7.html",children:"\u7740\u8272\u5668\u6a21\u578b 6.7"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"\u26a0\ufe0f \uff08\u90e8\u5206\uff09"}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["VK_KHR_shader_quad_control\uff0c",(0,n.jsx)("br",{}),"VkPhysicalDeviceFeatures::shaderStorageImageMultisample"]})]})]})]})]})}function a(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(h,{...e})}):h(e)}},6032:(e,t,l)=>{l.d(t,{A:()=>n});const n=l.p+"assets/images/what_is_spirv_dxc-83f8aedb7a1b5748663ee39c7f529146.png"},8453:(e,t,l)=>{l.d(t,{R:()=>s,x:()=>d});var n=l(6540);const r={},i=n.createContext(r);function s(e){const t=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),n.createElement(i.Provider,{value:t},e.children)}}}]);