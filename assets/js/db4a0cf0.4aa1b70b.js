"use strict";(self.webpackChunkvulkan_doc=self.webpackChunkvulkan_doc||[]).push([[2225],{2431:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>t,contentTitle:()=>c,default:()=>f,frontMatter:()=>i,metadata:()=>l,toc:()=>h});var d=n(4848),s=n(8453);const i={},c="KHR_buffer_device_address\u7684\u7528\u6cd5",l={permalink:"/blog/20.KHR_buffer_device_address\u7684\u7528\u6cd5",source:"@site/blog/20.KHR_buffer_device_address\u7684\u7528\u6cd5.md",title:"KHR_buffer_device_address\u7684\u7528\u6cd5",description:"VKKHRbufferdeviceaddress \u6269\u5c55\u662f Vulkan \u4e2d\u975e\u5e38\u91cd\u8981\u7684\u4e00\u4e2a\u529f\u80fd\uff0c\u5b83\u5141\u8bb8\u4f60\u4ece GPU \u4e0a\u76f4\u63a5\u83b7\u53d6 Buffer \u7684\u201c\u8bbe\u5907\u5730\u5740\u201d\uff0c\u4ece\u800c\u652f\u6301\uff1a",date:"2025-07-30T13:17:18.000Z",tags:[],readingTime:4.905,hasTruncateMarker:!1,authors:[],frontMatter:{},unlisted:!1,nextItem:{title:"shader object\u7528\u6cd5",permalink:"/blog/21.shader object"}},t={authorsImageUrls:[]},h=[{value:"\ud83e\udde9 \u7b80\u5355\u7406\u89e3\uff1a\u5b83\u7684\u4f5c\u7528\u662f\u4ec0\u4e48\uff1f",id:"-\u7b80\u5355\u7406\u89e3\u5b83\u7684\u4f5c\u7528\u662f\u4ec0\u4e48",level:2},{value:"\u2705 \u4e3b\u8981\u4f5c\u7528\u548c\u7528\u9014",id:"-\u4e3b\u8981\u4f5c\u7528\u548c\u7528\u9014",level:2},{value:"\ud83e\uddea \u793a\u4f8b\uff1a\u83b7\u53d6 Buffer \u7684\u8bbe\u5907\u5730\u5740",id:"-\u793a\u4f8b\u83b7\u53d6-buffer-\u7684\u8bbe\u5907\u5730\u5740",level:2},{value:"\u270d\ufe0f GLSL \u4e2d\u600e\u4e48\u4f7f\u7528\uff1f",id:"\ufe0f-glsl-\u4e2d\u600e\u4e48\u4f7f\u7528",level:2},{value:"\ud83d\ude80 \u4f7f\u7528\u6b65\u9aa4",id:"-\u4f7f\u7528\u6b65\u9aa4",level:2},{value:"\u26a0\ufe0f \u6ce8\u610f\u4e8b\u9879",id:"\ufe0f-\u6ce8\u610f\u4e8b\u9879",level:2},{value:"\u2705 \u603b\u7ed3",id:"-\u603b\u7ed3",level:2},{value:"\u793a\u4f8b",id:"\u793a\u4f8b",level:2},{value:"1\ufe0f\u20e3 Vulkan \u7aef\u51c6\u5907",id:"1\ufe0f\u20e3-vulkan-\u7aef\u51c6\u5907",level:3},{value:"2\ufe0f\u20e3 CPU \u7aef\u6784\u9020\u94fe\u8868\u6570\u636e",id:"2\ufe0f\u20e3-cpu-\u7aef\u6784\u9020\u94fe\u8868\u6570\u636e",level:3},{value:"3\ufe0f\u20e3 GLSL Shader \u4e2d\u4f7f\u7528\u6307\u9488\u8bbf\u95ee",id:"3\ufe0f\u20e3-glsl-shader-\u4e2d\u4f7f\u7528\u6307\u9488\u8bbf\u95ee",level:3},{value:"\u2705 \u603b\u7ed3\u6b65\u9aa4",id:"-\u603b\u7ed3\u6b65\u9aa4",level:2}];function o(e){const r={blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,s.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(r.p,{children:[(0,d.jsx)(r.code,{children:"VK_KHR_buffer_device_address"})," \u6269\u5c55\u662f Vulkan \u4e2d\u975e\u5e38\u91cd\u8981\u7684\u4e00\u4e2a\u529f\u80fd\uff0c\u5b83\u5141\u8bb8\u4f60",(0,d.jsx)(r.strong,{children:"\u4ece GPU \u4e0a\u76f4\u63a5\u83b7\u53d6 Buffer \u7684\u201c\u8bbe\u5907\u5730\u5740\u201d"}),"\uff0c\u4ece\u800c\u652f\u6301\uff1a"]}),"\n",(0,d.jsxs)(r.blockquote,{children:["\n",(0,d.jsxs)(r.p,{children:["\u2705 ",(0,d.jsx)(r.strong,{children:"\u6307\u9488\u5f0f GPU \u7f16\u7a0b"}),"\uff08\u5982 GPU \u4e0a\u7684\u7ed3\u6784\u4f53\u94fe\u8868\u3001\u6307\u9488\u8df3\u8f6c\u7b49\uff09"]}),"\n"]}),"\n",(0,d.jsx)(r.hr,{}),"\n",(0,d.jsx)(r.h2,{id:"-\u7b80\u5355\u7406\u89e3\u5b83\u7684\u4f5c\u7528\u662f\u4ec0\u4e48",children:"\ud83e\udde9 \u7b80\u5355\u7406\u89e3\uff1a\u5b83\u7684\u4f5c\u7528\u662f\u4ec0\u4e48\uff1f"}),"\n",(0,d.jsxs)(r.p,{children:["\u4f20\u7edf Vulkan \u4e2d\uff0cGPU \u65e0\u6cd5\u77e5\u9053 buffer \u5728\u8bbe\u5907\u4e0a\u7684\u5730\u5740\uff0c\u53ea\u80fd\u901a\u8fc7 binding \u6765\u8bbf\u95ee\u3002\u4f46\u5f00\u542f ",(0,d.jsx)(r.code,{children:"VK_KHR_buffer_device_address"})," \u540e\uff1a"]}),"\n",(0,d.jsxs)(r.blockquote,{children:["\n",(0,d.jsxs)(r.p,{children:["\u4f60\u53ef\u4ee5\u5728 GPU shader \u4e2d\u4f7f\u7528\u8bbe\u5907\u5730\u5740 (",(0,d.jsx)(r.code,{children:"deviceAddress"}),") \u6307\u5411\u67d0\u4e2a Buffer \u7684\u4efb\u610f\u4f4d\u7f6e\uff0c\u50cf\u6307\u9488\u4e00\u6837\u8bbf\u95ee\u5185\u5b58\u3002"]}),"\n"]}),"\n",(0,d.jsx)(r.hr,{}),"\n",(0,d.jsx)(r.h2,{id:"-\u4e3b\u8981\u4f5c\u7528\u548c\u7528\u9014",children:"\u2705 \u4e3b\u8981\u4f5c\u7528\u548c\u7528\u9014"}),"\n",(0,d.jsxs)(r.table,{children:[(0,d.jsx)(r.thead,{children:(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.th,{children:"\u4f5c\u7528"}),(0,d.jsx)(r.th,{children:"\u793a\u4f8b\u7528\u9014"})]})}),(0,d.jsxs)(r.tbody,{children:[(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:"1\ufe0f\u20e3 \u83b7\u53d6 GPU \u4e0a\u7684 buffer \u5730\u5740"}),(0,d.jsxs)(r.td,{children:[(0,d.jsx)(r.code,{children:"vkGetBufferDeviceAddress"})," \u53d6\u5f97\u6307\u9488"]})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:"2\ufe0f\u20e3 Shader \u4e2d\u53ef\u4ee5\u64cd\u4f5c raw \u8bbe\u5907\u5730\u5740"}),(0,d.jsx)(r.td,{children:"\u7528\u4e8e\u6784\u9020\u94fe\u8868\u3001\u6811\u3001BVH \u7b49"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:"3\ufe0f\u20e3 \u542f\u7528 GPU pointer \u8ba1\u7b97"}),(0,d.jsx)(r.td,{children:"\u7c7b\u4f3c C++ \u6307\u9488\uff0c\u5728 Shader \u91cc\u64cd\u4f5c\u5185\u5b58"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:"4\ufe0f\u20e3 \u5b9e\u73b0\u81ea\u5b9a\u4e49\u5185\u5b58\u7ba1\u7406\u5668"}),(0,d.jsx)(r.td,{children:"\u52a8\u6001\u5206\u914d\u3001\u8df3\u8f6c\u3001\u904d\u5386 GPU \u6570\u636e\u7ed3\u6784"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:"5\ufe0f\u20e3 \u652f\u6301 RTX \u548c\u52a0\u901f\u7ed3\u6784\uff08\u5982 BLAS/TLAS\uff09"}),(0,d.jsx)(r.td,{children:"\u5fc5\u987b\u8981\u6c42 device address"})]})]})]}),"\n",(0,d.jsx)(r.hr,{}),"\n",(0,d.jsx)(r.h2,{id:"-\u793a\u4f8b\u83b7\u53d6-buffer-\u7684\u8bbe\u5907\u5730\u5740",children:"\ud83e\uddea \u793a\u4f8b\uff1a\u83b7\u53d6 Buffer \u7684\u8bbe\u5907\u5730\u5740"}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{children:"cpp\u590d\u5236\u7f16\u8f91VkBufferDeviceAddressInfo addr_info = {\r\n    .sType = VK_STRUCTURE_TYPE_BUFFER_DEVICE_ADDRESS_INFO,\r\n    .buffer = myBuffer\r\n};\r\n\r\nVkDeviceAddress addr = vkGetBufferDeviceAddress(device, &addr_info);\n"})}),"\n",(0,d.jsxs)(r.p,{children:["\u8fd9\u4e2a\u5730\u5740\u53ef\u4ee5\u4f20\u5165 Shader\uff0c\u901a\u8fc7 ",(0,d.jsx)(r.code,{children:"uint64_t"})," \u63a5\u6536\uff0c\u7136\u540e\u505a\u6307\u9488\u8df3\u8f6c\u6216\u8bbf\u95ee\u3002"]}),"\n",(0,d.jsx)(r.hr,{}),"\n",(0,d.jsx)(r.h2,{id:"\ufe0f-glsl-\u4e2d\u600e\u4e48\u4f7f\u7528",children:"\u270d\ufe0f GLSL \u4e2d\u600e\u4e48\u4f7f\u7528\uff1f"}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{children:"glsl\u590d\u5236\u7f16\u8f91#extension GL_EXT_buffer_reference : enable\r\n#extension GL_EXT_buffer_reference2 : enable\r\n#extension GL_EXT_scalar_block_layout : enable\r\n\r\nlayout(buffer_reference, scalar) buffer Node;\r\n\r\nstruct Node {\r\n    float value;\r\n    Node next;   // \u5d4c\u5957\u5f15\u7528\r\n};\r\n\r\nlayout(set = 0, binding = 0) buffer Root {\r\n    Node root;\r\n};\r\n\r\nvoid main() {\r\n    Node current = root;\r\n    while (current.value < 10.0) {\r\n        current = current.next;\r\n    }\r\n}\n"})}),"\n",(0,d.jsxs)(r.p,{children:["\u8fd9\u5728\u4f20\u7edf Vulkan \u662f",(0,d.jsx)(r.strong,{children:"\u65e0\u6cd5\u5b9e\u73b0"}),"\u7684\u3002"]}),"\n",(0,d.jsx)(r.hr,{}),"\n",(0,d.jsx)(r.h2,{id:"-\u4f7f\u7528\u6b65\u9aa4",children:"\ud83d\ude80 \u4f7f\u7528\u6b65\u9aa4"}),"\n",(0,d.jsxs)(r.ol,{children:["\n",(0,d.jsx)(r.li,{children:(0,d.jsx)(r.strong,{children:"\u5f00\u542f\u6269\u5c55\uff1a"})}),"\n"]}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{children:'cpp\u590d\u5236\u7f16\u8f91enabledExtensions = {\r\n  "VK_KHR_buffer_device_address"\r\n};\n'})}),"\n",(0,d.jsxs)(r.ol,{children:["\n",(0,d.jsx)(r.li,{children:(0,d.jsx)(r.strong,{children:"\u542f\u7528\u8bbe\u5907\u7279\u6027\uff1a"})}),"\n"]}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{children:"cpp\u590d\u5236\u7f16\u8f91VkPhysicalDeviceBufferDeviceAddressFeatures features = {\r\n    .sType = VK_STRUCTURE_TYPE_PHYSICAL_DEVICE_BUFFER_DEVICE_ADDRESS_FEATURES,\r\n    .bufferDeviceAddress = VK_TRUE\r\n};\n"})}),"\n",(0,d.jsxs)(r.ol,{children:["\n",(0,d.jsx)(r.li,{children:(0,d.jsx)(r.strong,{children:"\u521b\u5efa buffer \u65f6\u52a0 flag\uff1a"})}),"\n"]}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{children:"cpp\r\n\r\n\r\n\u590d\u5236\u7f16\u8f91\r\nbufferCreateInfo.usage |= VK_BUFFER_USAGE_SHADER_DEVICE_ADDRESS_BIT;\n"})}),"\n",(0,d.jsxs)(r.ol,{children:["\n",(0,d.jsx)(r.li,{children:(0,d.jsxs)(r.strong,{children:["\u8c03\u7528 ",(0,d.jsx)(r.code,{children:"vkGetBufferDeviceAddress()"})," \u83b7\u53d6\u5730\u5740"]})}),"\n"]}),"\n",(0,d.jsx)(r.hr,{}),"\n",(0,d.jsx)(r.h2,{id:"\ufe0f-\u6ce8\u610f\u4e8b\u9879",children:"\u26a0\ufe0f \u6ce8\u610f\u4e8b\u9879"}),"\n",(0,d.jsxs)(r.table,{children:[(0,d.jsx)(r.thead,{children:(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.th,{children:"\u9650\u5236"}),(0,d.jsx)(r.th,{children:"\u63cf\u8ff0"})]})}),(0,d.jsxs)(r.tbody,{children:[(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:"\u5fc5\u987b GPU \u9a71\u52a8\u652f\u6301\u8be5\u6269\u5c55"}),(0,d.jsx)(r.td,{})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsxs)(r.td,{children:["\u5fc5\u987b\u8bbe\u7f6e ",(0,d.jsx)(r.code,{children:"VK_BUFFER_USAGE_SHADER_DEVICE_ADDRESS_BIT"})]}),(0,d.jsx)(r.td,{})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:"\u4ec5\u652f\u6301 Vulkan 1.2+ \u6216\u901a\u8fc7\u6269\u5c55\u5f00\u542f"}),(0,d.jsx)(r.td,{})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:"\u4f7f\u7528 device address \u610f\u5473\u7740\u9700\u8981\u6ce8\u610f\u5bf9\u9f50\u3001\u8bbf\u95ee\u5408\u6cd5\u6027\uff08\u4f60\u5728 shader \u4e2d\u201c\u8d8a\u754c\u201d\u4f1a\u5f15\u53d1 crash\uff09"}),(0,d.jsx)(r.td,{})]})]})]}),"\n",(0,d.jsx)(r.hr,{}),"\n",(0,d.jsx)(r.h2,{id:"-\u603b\u7ed3",children:"\u2705 \u603b\u7ed3"}),"\n",(0,d.jsxs)(r.table,{children:[(0,d.jsx)(r.thead,{children:(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.th,{children:"\u9879\u76ee"}),(0,d.jsx)(r.th,{children:"\u8bf4\u660e"})]})}),(0,d.jsxs)(r.tbody,{children:[(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:"\u6269\u5c55\u540d"}),(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"VK_KHR_buffer_device_address"})})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:"\u4f5c\u7528"}),(0,d.jsx)(r.td,{children:"\u83b7\u53d6 Buffer \u7684 GPU \u8bbe\u5907\u5730\u5740"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:"\u7528\u9014"}),(0,d.jsx)(r.td,{children:"GPU \u6307\u9488\u8bbf\u95ee\u3001\u52a0\u901f\u7ed3\u6784\uff08\u5982 RTX\uff09\u3001GPU \u5185\u5b58\u6c60\u7b49"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:"Shader \u8bbf\u95ee"}),(0,d.jsx)(r.td,{children:"GLSL/GL_EXT_buffer_reference + \u6307\u9488\u8df3\u8f6c"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:"Vulkan API"}),(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"vkGetBufferDeviceAddress"})})]})]})]}),"\n",(0,d.jsx)(r.h2,{id:"\u793a\u4f8b",children:"\u793a\u4f8b"}),"\n",(0,d.jsx)(r.h3,{id:"1\ufe0f\u20e3-vulkan-\u7aef\u51c6\u5907",children:"1\ufe0f\u20e3 Vulkan \u7aef\u51c6\u5907"}),"\n",(0,d.jsxs)(r.p,{children:[(0,d.jsx)(r.strong,{children:"\u542f\u7528\u6269\u5c55"})," ",(0,d.jsx)(r.code,{children:"VK_KHR_buffer_device_address"})," \u5e76\u8bbe\u7f6e\u7279\u6027"]}),"\n",(0,d.jsxs)(r.p,{children:[(0,d.jsx)(r.strong,{children:"\u521b\u5efa buffer"})," \u65f6\u52a0\u4e0a ",(0,d.jsx)(r.code,{children:"VK_BUFFER_USAGE_SHADER_DEVICE_ADDRESS_BIT"})]}),"\n",(0,d.jsxs)(r.p,{children:[(0,d.jsx)(r.strong,{children:"\u5206\u914d\u5185\u5b58"})," \u65f6\u52a0\u4e0a ",(0,d.jsx)(r.code,{children:"VK_MEMORY_ALLOCATE_DEVICE_ADDRESS_BIT"})]}),"\n",(0,d.jsxs)(r.p,{children:[(0,d.jsx)(r.strong,{children:"\u8bfb\u53d6 GPU \u5730\u5740"})," \u4f7f\u7528 ",(0,d.jsx)(r.code,{children:"vkGetBufferDeviceAddress"})]}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{children:"// 1. \u5728 VkDeviceCreateInfo \u7684 pNext \u94fe\u4e2d\u542f\u7528\u7279\u6027\r\nVkPhysicalDeviceBufferDeviceAddressFeaturesKHR bda_feat{};\r\nbda_feat.sType = VK_STRUCTURE_TYPE_PHYSICAL_DEVICE_BUFFER_DEVICE_ADDRESS_FEATURES_KHR;\r\nbda_feat.bufferDeviceAddress = VK_TRUE;\r\nVkPhysicalDeviceFeatures2 features2{VK_STRUCTURE_TYPE_PHYSICAL_DEVICE_FEATURES2};\r\nfeatures2.pNext = &bda_feat;\r\nvkGetPhysicalDeviceFeatures2(physDevice, &features2);\r\n\r\nVkDeviceCreateInfo di{VK_STRUCTURE_TYPE_DEVICE_CREATE_INFO};\r\ndi.pNext = &features2;\r\nvkCreateDevice(physDevice, &di, nullptr, &device);\r\n\r\n// 2. \u521b\u5efa buffer \u5e76\u5206\u914d\u652f\u6301 device address \u7684 memory\r\nVkBufferCreateInfo bi{VK_STRUCTURE_TYPE_BUFFER_CREATE_INFO};\r\nbi.size = sizeof(Node) * MAX_NODES;\r\nbi.usage = VK_BUFFER_USAGE_STORAGE_BUFFER_BIT | VK_BUFFER_USAGE_SHADER_DEVICE_ADDRESS_BIT;\r\n\r\nVkBuffer buf;\r\nvkCreateBuffer(device, &bi, nullptr, &buf);\r\n\r\nVkMemoryRequirements mr;\r\nvkGetBufferMemoryRequirements(device, buf, &mr);\r\n\r\nVkMemoryAllocateFlagsInfo flagsInfo{VK_STRUCTURE_TYPE_MEMORY_ALLOCATE_FLAGS_INFO};\r\nflagsInfo.flags = VK_MEMORY_ALLOCATE_DEVICE_ADDRESS_BIT_KHR;\r\n\r\nVkMemoryAllocateInfo mai{VK_STRUCTURE_TYPE_MEMORY_ALLOCATE_INFO};\r\nmai.allocationSize = mr.size;\r\nmai.memoryTypeIndex = find_mem_type(mr.memoryTypeBits, VK_MEMORY_PROPERTY_DEVICE_LOCAL_BIT);\r\nmai.pNext = &flagsInfo;\r\n\r\nVkDeviceMemory mem;\r\nvkAllocateMemory(device, &mai, nullptr, &mem);\r\nvkBindBufferMemory(device, buf, mem, 0);\r\n\r\n// 3. \u83b7\u53d6 GPU \u5730\u5740\r\nVkBufferDeviceAddressInfoKHR addrInfo{VK_STRUCTURE_TYPE_BUFFER_DEVICE_ADDRESS_INFO_KHR};\r\naddrInfo.buffer = buf;\r\nuint64_t gpuAddr = vkGetBufferDeviceAddressKHR(device, &addrInfo);\n"})}),"\n",(0,d.jsx)(r.h3,{id:"2\ufe0f\u20e3-cpu-\u7aef\u6784\u9020\u94fe\u8868\u6570\u636e",children:"2\ufe0f\u20e3 CPU \u7aef\u6784\u9020\u94fe\u8868\u6570\u636e"}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{children:"struct Node { uint32_t data; uint64_t next; };\r\n\r\nstd::vector<Node> nodes = {\r\n  {10, gpuAddr + sizeof(Node)*1},\r\n  {20, gpuAddr + sizeof(Node)*2},\r\n  {30, 0ull}\r\n};\r\nvkMemcpyToBuffer(buf, nodes.data(), sizeof(Node) * nodes.size());\n"})}),"\n",(0,d.jsxs)(r.p,{children:["\u8fd9\u91cc ",(0,d.jsx)(r.code,{children:"next"})," \u5b58\u50a8\u4e86 GPU \u5730\u5740\uff0c\u6307\u5411\u4e0b\u4e00\u4e2a\u8282\u70b9\u5f62\u6210\u94fe\u8868\u3002"]}),"\n",(0,d.jsx)(r.h3,{id:"3\ufe0f\u20e3-glsl-shader-\u4e2d\u4f7f\u7528\u6307\u9488\u8bbf\u95ee",children:"3\ufe0f\u20e3 GLSL Shader \u4e2d\u4f7f\u7528\u6307\u9488\u8bbf\u95ee"}),"\n",(0,d.jsx)(r.p,{children:"\u9700\u8981\u5f00\u542f\u6269\u5c55\u548c buffer reference\uff1a"}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{children:"#version 450\r\n#extension GL_EXT_buffer_reference : require\r\n\r\nlayout(buffer_reference, buffer_reference_align=8) buffer Node {\r\n    uint data;\r\n    Node next;\r\n};\r\n\r\nlayout(std430, set=0, binding=0) buffer Root {\r\n    Node root;\r\n};\r\n\r\nlayout(set=0, binding=1) uniform UBO {\r\n    uint dummy; // \u53ef\u9009\r\n} ubo;\r\n\r\nlayout(location=0) out uint outData;\r\n\r\nvoid main() {\r\n    Node cur = root;\r\n    while (cur.next != 0u) {\r\n        cur = cur.next;\r\n    }\r\n    outData = cur.data; // \u5e94\u8be5\u8f93\u51fa 30\r\n}\n"})}),"\n",(0,d.jsxs)(r.p,{children:["\u5728 shader \u4e2d\uff0c",(0,d.jsx)(r.code,{children:"root"})," \u4ece descriptor set 0 \u7ed1\u5b9a\uff0c\u5e76\u5305\u542b ",(0,d.jsx)(r.code,{children:"gpuAddr"}),"\u3002\u5b83\u76f4\u63a5\u4ee3\u8868\u94fe\u8868\u8d77\u59cb\u8282\u70b9\u3002"]}),"\n",(0,d.jsx)(r.h2,{id:"-\u603b\u7ed3\u6b65\u9aa4",children:"\u2705 \u603b\u7ed3\u6b65\u9aa4"}),"\n",(0,d.jsxs)(r.ol,{children:["\n",(0,d.jsxs)(r.li,{children:["\u542f\u7528 ",(0,d.jsx)(r.code,{children:"VK_KHR_buffer_device_address"})]}),"\n",(0,d.jsx)(r.li,{children:"\u521b\u5efa buffer + device \u5730\u5740 buffer memory"}),"\n",(0,d.jsxs)(r.li,{children:["\u8c03\u7528 ",(0,d.jsx)(r.code,{children:"vkGetBufferDeviceAddress"})]}),"\n",(0,d.jsx)(r.li,{children:"\u6784\u9020\u94fe\u8868\uff0c\u5199\u5165 GPU \u5730\u5740"}),"\n",(0,d.jsxs)(r.li,{children:["\u5728 GLSL shader \u4e2d\u4f7f\u7528 ",(0,d.jsx)(r.code,{children:"buffer_reference"})," \u6307\u5411\u94fe\u8868 start"]}),"\n",(0,d.jsx)(r.li,{children:"\u5728 shader \u4e2d\u81ea\u7531\u8df3\u8f6c\u3001\u8bfb\u53d6\u7ed3\u6784\u6570\u636e"}),"\n"]})]})}function f(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,d.jsx)(r,{...e,children:(0,d.jsx)(o,{...e})}):o(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>c,x:()=>l});var d=n(6540);const s={},i=d.createContext(s);function c(e){const r=d.useContext(i);return d.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function l(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),d.createElement(i.Provider,{value:r},e.children)}}}]);